# Windows-like environment for testing Dictionary App
FROM ubuntu:22.04

# Install basic dependencies
RUN apt-get update && apt-get install -y \
    wget \
    gnupg2 \
    software-properties-common \
    xvfb \
    x11vnc \
    fluxbox \
    python3 \
    python3-pip \
    python3-venv \
    python3-tk \
    && rm -rf /var/lib/apt/lists/*

# Install Wine
RUN dpkg --add-architecture i386 && \
    wget -qO - https://dl.winehq.org/wine-builds/winehq.key | apt-key add - && \
    add-apt-repository "deb https://dl.winehq.org/wine-builds/ubuntu/ jammy main" && \
    apt-get update && \
    apt-get install -y --install-recommends winehq-stable && \
    rm -rf /var/lib/apt/lists/*

# Set up Wine environment
RUN wine --version
ENV WINEPREFIX=/wine
ENV DISPLAY=:0

# Install Python in Wine
WORKDIR /app
RUN wget https://www.python.org/ftp/python/3.11.9/python-3.11.9-amd64.exe && \
    xvfb-run -a wine python-3.11.9-amd64.exe /quiet InstallAllUsers=1 PrependPath=1 && \
    rm python-3.11.9-amd64.exe

# Copy dictionary app
COPY . /app/

# Set up VNC for GUI access
EXPOSE 5900

# Start script
COPY start-windows-test.sh /start.sh
RUN chmod +x /start.sh

CMD ["/start.sh"]